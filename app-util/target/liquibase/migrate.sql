-- *********************************************************************
-- Update Database Script
-- *********************************************************************
-- Change Log: src/liquibase/master.xml
-- Ran at: 11.04.22 19:06
-- Against: postgres@jdbc:postgresql://localhost:5432/EmployeeHandbook
-- Liquibase version: 4.9.1
-- *********************************************************************

-- Create Database Lock Table
CREATE TABLE databasechangeloglock (ID INTEGER NOT NULL, LOCKED BOOLEAN NOT NULL, LOCKGRANTED TIMESTAMP WITHOUT TIME ZONE, LOCKEDBY VARCHAR(255), CONSTRAINT databasechangeloglock_pkey PRIMARY KEY (ID));

-- Initialize Database Lock Table
DELETE FROM databasechangeloglock;

INSERT INTO databasechangeloglock (ID, LOCKED) VALUES (1, FALSE);

-- Lock Database
UPDATE databasechangeloglock SET LOCKED = TRUE, LOCKEDBY = 'DESKTOP-HTVNRPB (192.168.0.7)', LOCKGRANTED = NOW() WHERE ID = 1 AND LOCKED = FALSE;

-- Create Database Change Log Table
CREATE TABLE databasechangelog (ID VARCHAR(255) NOT NULL, AUTHOR VARCHAR(255) NOT NULL, FILENAME VARCHAR(255) NOT NULL, DATEEXECUTED TIMESTAMP WITHOUT TIME ZONE NOT NULL, ORDEREXECUTED INTEGER NOT NULL, EXECTYPE VARCHAR(10) NOT NULL, MD5SUM VARCHAR(35), DESCRIPTION VARCHAR(255), COMMENTS VARCHAR(255), TAG VARCHAR(255), LIQUIBASE VARCHAR(20), CONTEXTS VARCHAR(255), LABELS VARCHAR(255), DEPLOYMENT_ID VARCHAR(10));

-- Changeset src/liquibase/v01.xml::v01-1::IaroslavOmelianenko
CREATE TABLE departments (departmentid INTEGER GENERATED BY DEFAULT AS IDENTITY NOT NULL, departmentname VARCHAR(50) NOT NULL, director VARCHAR(50) NOT NULL, moderator VARCHAR(50), headdepartment VARCHAR(50), subordinatedepartment VARCHAR(50), CONSTRAINT departments_pkey PRIMARY KEY (departmentid), UNIQUE (departmentname));

INSERT INTO databasechangelog (ID, AUTHOR, FILENAME, DATEEXECUTED, ORDEREXECUTED, MD5SUM, DESCRIPTION, COMMENTS, EXECTYPE, CONTEXTS, LABELS, LIQUIBASE, DEPLOYMENT_ID) VALUES ('v01-1', 'IaroslavOmelianenko', 'src/liquibase/v01.xml', NOW(), 1, '8:6f989e28ff435b8014804f634982d956', 'createTable tableName=departments', '', 'EXECUTED', NULL, NULL, '4.9.1', '9693185277');

-- Changeset src/liquibase/v01.xml::v01-2::IaroslavOmelianenko
CREATE TABLE employees (employeeid INTEGER GENERATED BY DEFAULT AS IDENTITY NOT NULL, name VARCHAR(50) NOT NULL, email VARCHAR(50) NOT NULL, department INTEGER, position VARCHAR(50) NOT NULL, role VARCHAR(50) NOT NULL, CONSTRAINT employees_pkey PRIMARY KEY (employeeid), CONSTRAINT department FOREIGN KEY (department) REFERENCES departments(departmentid), UNIQUE (name));

INSERT INTO databasechangelog (ID, AUTHOR, FILENAME, DATEEXECUTED, ORDEREXECUTED, MD5SUM, DESCRIPTION, COMMENTS, EXECTYPE, CONTEXTS, LABELS, LIQUIBASE, DEPLOYMENT_ID) VALUES ('v01-2', 'IaroslavOmelianenko', 'src/liquibase/v01.xml', NOW(), 2, '8:fb9ec973904f10d6758fe8e602cf56d7', 'createTable tableName=employees', '', 'EXECUTED', NULL, NULL, '4.9.1', '9693185277');

-- Changeset src/liquibase/v01.xml::v01-3::IaroslavOmelianenko
INSERT INTO departments (departmentname, director, moderator, subordinatedepartment) VALUES ('main office', 'Marty McFly', 'Marty McFly', 'management subdivision');

INSERT INTO departments (departmentname, director, moderator, headdepartment, subordinatedepartment) VALUES ('management subdivision', 'Gregory House', 'James Wilson', 'main office', 'sales department');

INSERT INTO departments (departmentname, director, headdepartment) VALUES ('sales department', 'Davy Jones', 'management subdivision');

INSERT INTO employees (name, email, department, position, role) VALUES ('Marty McFly', 'mmcfly@mail.com', '1', 'director', 'admin');

INSERT INTO employees (name, email, department, position, role) VALUES ('Doc Brown', 'dbrown@mail.com', '1', 'deputy director', 'user');

INSERT INTO employees (name, email, department, position, role) VALUES ('Gregory House', 'ghouse@mail.com', '2', 'manager', 'user');

INSERT INTO employees (name, email, department, position, role) VALUES ('James Wilson', 'jwilson@mail.com', '2', 'manager', 'moderator');

INSERT INTO employees (name, email, department, position, role) VALUES ('Davy Jones', 'djones@mail.com', '3', 'salesman', 'user');

INSERT INTO employees (name, email, department, position, role) VALUES ('Hector Barbossa', 'hbarbossa@mail.com', '3', 'salesman', 'user');

INSERT INTO databasechangelog (ID, AUTHOR, FILENAME, DATEEXECUTED, ORDEREXECUTED, MD5SUM, DESCRIPTION, COMMENTS, EXECTYPE, CONTEXTS, LABELS, LIQUIBASE, DEPLOYMENT_ID) VALUES ('v01-3', 'IaroslavOmelianenko', 'src/liquibase/v01.xml', NOW(), 3, '8:018a29d1fc3f23985011f250b44a0881', 'insert tableName=departments; insert tableName=departments; insert tableName=departments; insert tableName=employees; insert tableName=employees; insert tableName=employees; insert tableName=employees; insert tableName=employees; insert tableName=...', '', 'EXECUTED', NULL, NULL, '4.9.1', '9693185277');

-- Release Database Lock
UPDATE databasechangeloglock SET LOCKED = FALSE, LOCKEDBY = NULL, LOCKGRANTED = NULL WHERE ID = 1;

